<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>
<!-- xml 을 java 에서 쓰기 위해 연결되는 interface 가 필요 하다. -->

<!-- 쿼리문을 작성해둔 interface 주소 -->
<mapper namespace="com.pet.mypage.dao.MyPageDAO">
   
   <insert id="profileWrite">
   	INSERT INTO profile(userID, petAge, petName, petGender, petNeutered, petIntroduce, petSize)
   	VALUES(#{param1}, #{param4}, #{param3}, #{param5}, #{param6}, #{param7}, #{param2})
   </insert>
      
   <select id="findprofile" resultType="com.pet.mypage.dto.MyPageDTO">
   	SELECT * FROM profile WHERE userID = #{param1}
   </select>
   
   <select id="findprofileAndphoto" resultType="com.pet.mypage.dto.MyPageDTO">
	  SELECT p.*, ph.serPhotoname FROM profile p
	  LEFT JOIN photo ph ON p.profileID = ph.photoidenNum 
	  WHERE p.userID = #{param1} AND ph.categoryCode = #{param2} AND ph.photoidenNum = #{param3} AND ph.photoBlindWhether = 0
	</select>
	
	<update id="petprofileUpdate">
		UPDATE profile SET petAge = #{param4}, petName = #{param3}, petGender = #{param5}, petNeutered = #{param6}, petIntroduce = #{param7}, petSize = #{param2}
		WHERE userID=#{param1}
	</update>
		
	<select id="myinquiryList" resultType="com.pet.mypage.dto.MyPageDTO">		
		SELECT * FROM board WHERE userID = #{param3} 
		AND categoryCode IN ('B_06', 'B_07', 'B_08', 'B_09', 'B_10', 'B_11') 
		ORDER BY boardWriteDate DESC	
	</select>
	
	<select id="findrouteShareList">
		SELECT * FROM routeboard WHERE userID = #{param1}
	</select>
	
	<select id="totalCount" resultType="int">
	   	SELECT COUNT(walkNum) FROM routelist WHERE userID = #{param1}
	</select>
	
	<select id="myroutlistCalllist" resultType="com.pet.mypage.dto.MyPageDTO">
	   	SELECT * FROM routelist WHERE userID= #{param3} ORDER BY walkDate  DESC 
	   	LIMIT #{param1} OFFSET #{param2}   
	</select>
	
	<select id="mybookmarktotalCount" resultType="int">
	   	SELECT COUNT(walkNum) FROM routelist WHERE walkNum = (SELECT walknum FROM bookmark WHERE userID = #{param3}) ORDER BY walkDate  DESC	   	
	</select>
	
	<select id="mybookmarklistCall" resultType="com.pet.mypage.dto.MyPageDTO">	   		   			
		SELECT * FROM routelist WHERE walkNum = (SELECT walknum FROM bookmark WHERE userID = #{param3}) ORDER BY walkDate  DESC 
		LIMIT #{param1} OFFSET #{param2}
	</select>
	
	<select id="myinquirytotalCount" resultType="int">		
		SELECT COUNT(boardNum) FROM board WHERE userID = #{param3} 
		AND categoryCode IN ('B_06', 'B_07', 'B_08', 'B_09', 'B_10', 'B_11') 
		ORDER BY boardWriteDate DESC		
	</select>
	
	<select id="myinquirylistCall" resultType="com.pet.mypage.dto.MyPageDTO">		
		SELECT * FROM board WHERE userID = #{param3} 
		AND categoryCode IN ('B_06', 'B_07', 'B_08', 'B_09', 'B_10', 'B_11') 
		ORDER BY boardWriteDate DESC	
		LIMIT #{param1} OFFSET #{param2}	
	</select>
	
	<select id="myreporttotalCount" resultType="int">		
		SELECT COUNT(reportNum) FROM report WHERE userID = #{param3} 		
	</select>
	
	<select id="myreportlistCall" resultType="com.pet.mypage.dto.MyPageDTO">		
		SELECT * FROM report WHERE userID = #{param3} 
		ORDER BY reportDate DESC LIMIT #{param1} OFFSET #{param2}
	</select>
	
	<select id="metotalCount" parameterType="HashMap" resultType="java.lang.Integer">
		SELECT COUNT(boardNum) FROM board 
		WHERE
			<choose>
				<when test="param2 == 'default' ">
					categoryCode IN ('B_06','B_07','B_08','B_09','B_10','B_11')
				</when>	
				<otherwise>
                categoryCode = #{param5} AND inqProcess = #{param3} AND userID = #{param4}
                </otherwise>
			</choose>
		</select>
		
	<select id="metotalCountprocess" parameterType="HashMap" resultType="java.lang.Integer">
		SELECT COUNT(boardNum) FROM board 
		WHERE
				<choose>
				<when test="param3 == 'default' ">
					categoryCode IN ('B_06','B_07','B_08','B_09','B_10','B_11')
				</when>	
				</choose>
		AND inqProcess = #{param2} AND userID = #{param4}
	</select>
		
	<select id="metotalCountinquiry" parameterType="HashMap" resultType="java.lang.Integer">
		SELECT COUNT(boardNum) FROM board WHERE categoryCode = #{param2} AND userID = #{param3}
	</select>
	
	<select id="metotalCountAll" parameterType="HashMap" resultType="java.lang.Integer">
		SELECT COUNT(boardNum) FROM board WHERE categoryCode = #{param2} AND inqProcess = #{param3} AND userID = #{param4}
	</select>	
	
	<!-- 아작스는 * 쓰면 안됨 -->
	<select id="meinquirylist" parameterType="HashMap" resultType="com.pet.admin.dto.InquiryDTO">
		SELECT boardNum, categoryCode, userID, boardName, boardDetail, boardbHit, boardWriteDate, noticeWhether, boardBlindWhether, inqProcess 
		FROM board 
		WHERE
			<choose>
				<when test="param4 == 'default' ">
					categoryCode IN ('B_06','B_07','B_08','B_09','B_10','B_11')
				</when>	
				<otherwise>
	               categoryCode = #{param4} AND inqProcess = #{param3} AND userID = #{param6}
	               </otherwise>
			</choose>
		ORDER BY boardNum DESC
		LIMIT #{param2} OFFSET #{param3} 
	</select>
	
	<select id="melistinquiry" parameterType="HashMap" resultType="com.pet.admin.dto.InquiryDTO">
		SELECT boardNum, categoryCode, userID, boardName, boardDetail, boardbHit, boardWriteDate, noticeWhether,boardBlindWhether,inqProcess 
		FROM board WHERE categoryCode = #{param2} AND userID = #{param5} ORDER BY boardNum DESC
		LIMIT #{param3} OFFSET #{param4}
	</select>
	
	<select id="melistinqAll" parameterType="HashMap" resultType="com.pet.admin.dto.InquiryDTO">
		SELECT boardNum, categoryCode, userID, boardName, boardDetail, boardbHit, boardWriteDate, noticeWhether,boardBlindWhether,inqProcess 
		FROM board WHERE categoryCode = #{param2} AND inqProcess = #{param3, jdbcType=BOOLEAN} AND userID = #{param6} ORDER BY boardNum DESC
		LIMIT #{param4} OFFSET #{param5}
	</select>
	
	<select id="melistinqprocess" parameterType="HashMap" resultType="com.pet.admin.dto.InquiryDTO">
		SELECT boardNum, categoryCode, userID, boardName, boardDetail, boardbHit, boardWriteDate, noticeWhether,boardBlindWhether,inqProcess 
		FROM board 
		WHERE
		<choose>
				<when test="param5 == 'default' ">
					categoryCode IN ('B_06','B_07','B_08','B_09','B_10','B_11')
				</when>	
				</choose>
		AND inqProcess = #{param2} AND userID = #{param6}ORDER BY boardNum DESC
		LIMIT #{param3} OFFSET #{param4}
	</select>
	
	
	

   
</mapper>